<!-- User Profile Container -->
<div class="max-w-4xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
  <h1 class="text-3xl font-bold text-gray-900 mb-6">Your Profile</h1>

  <!-- Profile Form -->
  <div class="bg-white p-6 rounded-lg shadow">
    <!-- Bind to the FormGroup -->
    <form
      [formGroup]="profileFormGroup"
      (ngSubmit)="updateProfile()"
      class="space-y-6"
    >
      <h2 class="text-xl font-semibold text-gray-800 border-b pb-3 mb-4">
        Personal Information
      </h2>

      <!-- First Name -->
      <div>
        <label
          for="profileFirstName"
          class="block text-sm font-medium text-gray-700"
          >First Name</label
        >
        <input
          type="text"
          id="profileFirstName"
          formControlName="first_name"
          autocomplete="given-name"
          class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
        />
        <!-- Add validation messages if needed -->
        <div
          *ngIf="
            profileFormGroup.get('first_name')?.invalid &&
            (profileFormGroup.get('first_name')?.dirty ||
              profileFormGroup.get('first_name')?.touched)
          "
          class="text-red-600 text-xs mt-1"
        >
          First name is required.
          <!-- Example validation -->
        </div>
      </div>

      <!-- Last Name -->
      <div>
        <label
          for="profileLastName"
          class="block text-sm font-medium text-gray-700"
          >Last Name</label
        >
        <input
          type="text"
          id="profileLastName"
          formControlName="last_name"
          autocomplete="family-name"
          class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
        />
        <div
          *ngIf="
            profileFormGroup.get('last_name')?.invalid &&
            (profileFormGroup.get('last_name')?.dirty ||
              profileFormGroup.get('last_name')?.touched)
          "
          class="text-red-600 text-xs mt-1"
        >
          Last name is required.
          <!-- Example validation -->
        </div>
      </div>

      <!-- Email Address (Readonly) -->
      <div>
        <label
          for="profileEmail"
          class="block text-sm font-medium text-gray-700"
          >Email Address</label
        >
        <input
          type="email"
          id="profileEmail"
          formControlName="email"
          autocomplete="email"
          class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-gray-100 focus:outline-none sm:text-sm text-gray-500 cursor-not-allowed"
        />
      </div>

      <!-- Phone Number (Optional) -->
      <div>
        <label
          for="profilePhone"
          class="block text-sm font-medium text-gray-700"
          >Phone Number (Optional)</label
        >
        <input
          type="tel"
          id="profilePhone"
          formControlName="phone_number"
          autocomplete="tel"
          class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
        />
      </div>

      <!-- Address Line 1 -->
      <div>
        <label
          for="profileAddress1"
          class="block text-sm font-medium text-gray-700"
          >Address Line 1</label
        >
        <input
          type="text"
          id="profileAddress1"
          formControlName="address_line1"
          autocomplete="address-line1"
          class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
        />
      </div>

      <!-- Address Line 2 -->
      <div>
        <label
          for="profileAddress2"
          class="block text-sm font-medium text-gray-700"
          >Address Line 2 (Optional)</label
        >
        <input
          type="text"
          id="profileAddress2"
          formControlName="address_line2"
          autocomplete="address-line2"
          class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
        />
      </div>

      <!-- City -->
      <div>
        <label for="profileCity" class="block text-sm font-medium text-gray-700"
          >City</label
        >
        <input
          type="text"
          id="profileCity"
          formControlName="city"
          autocomplete="address-level2"
          class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
        />
      </div>

      <!-- State/Province -->
      <div>
        <label
          for="profileState"
          class="block text-sm font-medium text-gray-700"
          >State / Province</label
        >
        <input
          type="text"
          id="profileState"
          formControlName="state"
          autocomplete="address-level1"
          class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
        />
      </div>

      <!-- Postal Code -->
      <div>
        <label
          for="profilepostal_code"
          class="block text-sm font-medium text-gray-700"
          >Postal Code</label
        >
        <input
          type="text"
          id="profilepostal_code"
          formControlName="postal_code"
          autocomplete="postal-code"
          class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
        />
      </div>

      <!-- Country -->
      <div>
        <label
          for="profileCountry"
          class="block text-sm font-medium text-gray-700"
          >Country</label
        >
        <input
          type="text"
          id="profileCountry"
          formControlName="country"
          autocomplete="country-name"
          class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
        />
      </div>

      <!-- Loading, Success, Error Messages -->
      <div *ngIf="isLoadingProfile()" class="text-sm text-gray-500">
        Updating...
      </div>
      <div *ngIf="profileSuccess()" class="text-sm text-green-600">
        {{ profileSuccess() }}
      </div>
      <div *ngIf="profileError()" class="text-sm text-red-600">
        {{ profileError() }}
      </div>

      <!-- Update Profile Button -->
      <div class="pt-4 flex justify-end space-x-3">
        <button
          type="button"
          (click)="resetForm()"
          class="py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"
        >
          Reset
        </button>
        <button
          type="submit"
          [disabled]="profileFormGroup.invalid || !profileFormGroup.dirty"
          class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed transition duration-150 ease-in-out"
        >
          Update Profile
        </button>
      </div>
    </form>
  </div>

  <!-- Payment Methods Section -->
  <div class="mt-8 bg-white p-6 rounded-lg shadow">
    <h2 class="text-xl font-semibold text-gray-800 border-b pb-3 mb-4">
      Payment Methods (Simulation)
    </h2>

    <!-- Loading/Error State for Payment Methods -->
    <div *ngIf="isLoadingPaymentMethods()" class="text-sm text-gray-500">
      Loading payment methods...
    </div>
    <div *ngIf="paymentError()" class="text-sm text-red-600">
      {{ paymentError() }}
    </div>

    <!-- Display Existing Payment Methods -->
    <div *ngIf="!isLoadingPaymentMethods() && !paymentError()">
      <div *ngIf="paymentMethods().length === 0" class="text-gray-500 text-sm">
        You have no saved payment methods.
      </div>
      <ul *ngIf="paymentMethods().length > 0" class="divide-y divide-gray-200">
        <li
          *ngFor="let method of paymentMethods()"
          class="py-3 flex justify-between items-center"
        >
          <div>
            <span class="font-medium text-gray-900">{{ method.type }}</span>
            <span class="text-gray-600 ml-2">ending in {{ method.last4 }}</span>
            <span
              *ngIf="method.expiryMonth && method.expiryYear"
              class="text-gray-500 text-sm ml-2"
            >
              (Expires {{ method.expiryMonth }}/{{ method.expiryYear }})
            </span>
            <span
              *ngIf="method.isDefault"
              class="ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"
            >
              Default
            </span>
          </div>
          <div class="space-x-2">
            <button
              *ngIf="!method.isDefault"
              (click)="makeDefaultPaymentMethod(method.id)"
              type="button"
              class="text-indigo-600 hover:text-indigo-800 text-sm font-medium"
            >
              Make Default
            </button>
            <button
              (click)="removePaymentMethod(method.id)"
              type="button"
              class="text-red-600 hover:text-red-800 text-sm font-medium"
            >
              Remove
            </button>
          </div>
        </li>
      </ul>
    </div>

    <!-- Add New Payment Method Form -->
    <div class="mt-6 pt-4 border-t">
      <h3 class="text-lg font-medium text-gray-900 mb-3">
        Add New Payment Method
      </h3>
      <!-- Bind to the addPaymentMethodForm FormGroup -->
      <form
        [formGroup]="addPaymentMethodForm"
        (ngSubmit)="addNewPaymentMethod()"
        class="space-y-4"
      >
        <div>
          <label for="pmType" class="block text-sm font-medium text-gray-700"
            >Type</label
          >
          <select
            id="pmType"
            formControlName="type"
            class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"
          >
            <option>Credit Card</option>
            <option>Debit Card</option>
            <option>PayPal</option>
          </select>
        </div>
        <div>
          <label
            for="pmCardNumber"
            class="block text-sm font-medium text-gray-700"
            >Card Number</label
          >
          <input
            type="text"
            id="pmCardNumber"
            formControlName="cardNumber"
            placeholder="Enter 15 or 16 digit card number"
            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
          />
          <div
            *ngIf="
              addPaymentMethodForm.get('cardNumber')?.invalid &&
              (addPaymentMethodForm.get('cardNumber')?.dirty ||
                addPaymentMethodForm.get('cardNumber')?.touched)
            "
            class="text-red-600 text-xs mt-1"
          >
            Please enter a valid 15 or 16 digit card number.
          </div>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label
              for="pmExpiryMonth"
              class="block text-sm font-medium text-gray-700"
              >Expiry Month (MM)</label
            >
            <input
              type="number"
              id="pmExpiryMonth"
              formControlName="expiryMonth"
              placeholder="MM"
              class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
            />
            <div
              *ngIf="
                addPaymentMethodForm.get('expiryMonth')?.invalid &&
                (addPaymentMethodForm.get('expiryMonth')?.dirty ||
                  addPaymentMethodForm.get('expiryMonth')?.touched)
              "
              class="text-red-600 text-xs mt-1"
            >
              Enter a valid month (1-12).
            </div>
          </div>
          <div>
            <label
              for="pmExpiryYear"
              class="block text-sm font-medium text-gray-700"
              >Expiry Year (YYYY)</label
            >
            <input
              type="number"
              id="pmExpiryYear"
              formControlName="expiryYear"
              placeholder="YYYY"
              class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
            />
            <div
              *ngIf="
                addPaymentMethodForm.get('expiryYear')?.invalid &&
                (addPaymentMethodForm.get('expiryYear')?.dirty ||
                  addPaymentMethodForm.get('expiryYear')?.touched)
              "
              class="text-red-600 text-xs mt-1"
            >
              Enter a valid year (current or future).
            </div>
          </div>
        </div>
        <div class="flex justify-end">
          <button
            type="submit"
            [disabled]="addPaymentMethodForm.invalid"
            class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            Add Payment Method
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Example: My Bookings Section -->
  <!--
  <div class="mt-8 bg-white p-6 rounded-lg shadow">
    <h2 class="text-xl font-semibold text-gray-800 border-b pb-3 mb-4">My Bookings</h2>
    <app-bookings-list></app-bookings-list>
  </div>
  -->
</div>
